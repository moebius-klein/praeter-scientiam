<!DOCTYPE html>
<html lang="la">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Codex Δ – QUARE MUNDI SUNT?</title>

  <!-- Cinzel Font -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-top: #1a0826;
      --bg-bottom: #050308;
      --gold-main: #f4e3b3;
      --gold-soft: #d8c088;
      --gold-strong: #ffecb3;
      --purple-deep: #140b1f;
      --text-main: #f4e3b3;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      width: 100%;
      height: 100%;
      overflow-x: hidden;
      background: linear-gradient(to bottom, var(--bg-top), var(--bg-bottom));
      font-family: "Cinzel", serif;
      color: var(--text-main);
      cursor: default;
      caret-color: transparent;
    }

    /* Global: keine Textauswahl */
    body, main, svg, .codex,
    #siegel-container, #sigillum-wrapper {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      caret-color: transparent;
    }

    main {
      width: 100%;
      max-width: 1600px;
      margin: 0 auto;
      padding: 0.3rem 0.5rem 1.5rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 2;
    }

    /* STARFIELD – dynamisch */
    #starfield {
      position: fixed;
      inset: 0;
      z-index: 0;
      background:
        radial-gradient(circle at 20% 20%, rgba(255,255,255,0.3) 0, transparent 40%),
        radial-gradient(circle at 80% 30%, rgba(255,255,200,0.25) 0, transparent 40%),
        radial-gradient(circle at 50% 80%, rgba(200,150,255,0.22) 0, transparent 45%),
        radial-gradient(circle at 10% 70%, rgba(180,180,255,0.18) 0, transparent 45%);
      opacity: 0;
      transform: scale(1.02);
      transition: opacity 6s ease-out, transform 10s ease-out;
      overflow: hidden;
      pointer-events: none;
    }

    /* fixe Sterne mit Twinkle-Animation */
    .star-fixed {
      position: absolute;
      border-radius: 50%;
      background: radial-gradient(circle, #fff 0%, #fff8 40%, transparent 70%);
      opacity: 0.4;
      animation-name: starTwinkle;
      animation-timing-function: ease-in-out;
      animation-iteration-count: infinite;
    }

    /* Twinkle – langsam heller/dunkler + minimaler Scale */
    @keyframes starTwinkle {
      0%   { opacity: 0.15; transform: scale(1); }
      40%  { opacity: 0.85; transform: scale(1.2); }
      60%  { opacity: 0.55; transform: scale(1.05); }
      100% { opacity: 0.15; transform: scale(1); }
    }

    /* Deutlich sichtbare, aus der Mitte herausfliegende Sterne */
    .star-fly {
      position: absolute;
      left: 50vw;
      top: 50vh;
      width: 3px;
      height: 3px;
      border-radius: 50%;
      background: radial-gradient(circle, #fff 0%, #fff 50%, rgba(255,255,255,0.1) 80%);
      pointer-events: none;
      opacity: 0;
      filter: blur(0.6px);
      animation: starFly 16s linear forwards;
    }

    /* Bahn: aus dem Zentrum nach außen */
    @keyframes starFly {
      0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.2);
        filter: blur(0.3px);
      }
      10% {
        opacity: 1;
        transform:
          translate(calc(-50% + var(--vx) * 1),
                    calc(-50% + var(--vy) * 1))
          scale(0.6);
        filter: blur(0.2px);
      }
      60% {
        opacity: 0.8;
        transform:
          translate(calc(-50% + var(--vx) * 3),
                    calc(-50% + var(--vy) * 3))
          scale(1.5);
        filter: blur(1.2px);
      }
      100% {
        opacity: 0;
        transform:
          translate(calc(-50% + var(--vx) * 5.5),
                    calc(-50% + var(--vy) * 5.5))
          scale(2.2);
        filter: blur(2.5px);
      }
    }

    svg {
      caret-color: transparent;
    }

    /* TEXTSTIL – Outline gold, innen transparent */
    .codex {
      font-family: "Cinzel", "Times New Roman", serif;
      font-variant-ligatures: none;
      text-anchor: middle;
      dominant-baseline: middle;
      letter-spacing: 1.0px;
      fill: transparent;
      stroke: var(--gold-main);
      stroke-width: 1.1px;
      stroke-linejoin: round;
      stroke-linecap: round;
      font-weight: 700;
      cursor: default;
    }

    /* ÜBERSCHRIFTEN */
    .siegel-heading,
    .siegel-subheading {
      width: 100%;
      height: auto;
      margin: 0 auto;
      opacity: 0;
      transform: scale(0.001);
      transform-origin: center center;
      pointer-events: none;
    }

    .siegel-heading {
      margin-bottom: 0.3rem;
      transition: transform 10s ease-out, opacity 4s ease-in;
    }

    .siegel-subheading {
      margin-top: 0.3rem;
      transition: transform 10s ease-out, opacity 6s ease-in;
    }

    .siegel-heading.visible,
    .siegel-subheading.visible {
      opacity: 1;
      transform: scale(1);
    }

    .siegel-heading.heading-glow {
      animation: headingGlow 12s ease-in-out infinite;
    }

    .siegel-heading.fade-out,
    .siegel-subheading.fade-out {
      opacity: 0;
    }

    @keyframes headingGlow {
      0%   { filter: drop-shadow(0 0 0 rgba(244,227,179,0)); }
      25%  { filter: drop-shadow(0 0 16px rgba(244,227,179,0.7)); }
      50%  { filter: drop-shadow(0 0 6px rgba(244,227,179,0.35)); }
      75%  { filter: drop-shadow(0 0 18px rgba(244,227,179,0.6)); }
      100% { filter: drop-shadow(0 0 0 rgba(244,227,179,0)); }
    }

    /* SIEGEL */
    #siegel-container {
      margin-top: 0.2rem;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #sigillum-wrapper {
      width: 90%;
      max-width: 1200px;
      height: auto;
      margin: 0 auto;
      filter: drop-shadow(0 0 12px rgba(244, 227, 179, 0.25));
      transform: scale(0.05);
      transform-origin: center center;
      transition: transform 3s ease-out;
      position: relative;
      opacity: 0;
    }

    #sigillum-wrapper.visible-sigil {
      opacity: 1;
    }

    #sigillum-img {
      width: 100%;
      height: auto;
      display: block;
      transform-origin: center center;
      pointer-events: none;
      caret-color: transparent;
    }

    /* Klick-Overlay für den ersten Klick auf das Siegel */
    #sigillum-click-overlay {
      position: absolute;
      inset: 0;
      z-index: 10;
      background: transparent;
      cursor: pointer;
    }

    /* Dante-Rotation */
    @keyframes rotateDante {
      0%   { transform: rotate(0deg); }
      100% { transform: rotate(-360deg); }
    }

    .rotate-dante {
      animation: rotateDante 32s linear infinite;
      transform-origin: center center;
    }

    /* BURST */
    #sigillum-burst {
      position: absolute;
      inset: 0;
      pointer-events: none;
      opacity: 0;
      transform: scale(0.2);
      background:
        radial-gradient(circle,
          rgba(255,255,255,1) 0%,
          rgba(255,250,210,0.9) 12%,
          rgba(255,220,120,0.4) 30%,
          rgba(255,220,120,0) 60%
        ),
        conic-gradient(
          from 0deg,
          rgba(255,255,240,0.9) 0deg,
          rgba(255,255,240,0) 12deg,
          rgba(255,255,240,0) 20deg,
          rgba(255,255,240,0) 30deg,
          rgba(255,255,240,0.8) 36deg,
          rgba(255,255,240,0) 48deg,
          rgba(255,255,240,0) 60deg,
          rgba(255,255,240,0.9) 72deg,
          rgba(255,255,240,0) 84deg,
          rgba(255,255,240,0) 96deg,
          rgba(255,255,240,0.9) 108deg,
          rgba(255,255,240,0) 120deg,
          rgba(255,255,240,0) 132deg,
          rgba(255,255,240,0.8) 144deg,
          rgba(255,255,240,0) 156deg,
          rgba(255,255,240,0) 168deg,
          rgba(255,255,240,0.9) 180deg,
          rgba(255,255,240,0) 192deg,
          rgba(255,255,240,0) 204deg,
          rgba(255,255,240,0.9) 216deg,
          rgba(255,255,240,0) 228deg,
          rgba(255,255,240,0) 240deg,
          rgba(255,255,240,0.8) 252deg,
          rgba(255,255,240,0) 264deg,
          rgba(255,255,240,0) 276deg,
          rgba(255,255,240,0.9) 288deg,
          rgba(255,255,240,0) 300deg,
          rgba(255,255,240,0) 312deg,
          rgba(255,255,240,0.8) 324deg,
          rgba(255,255,240,0) 336deg,
          rgba(255,255,240,0) 348deg,
          rgba(255,255,240,0.9) 360deg
        );
      mix-blend-mode: screen;
      z-index: 5;
      transition: opacity 0.4s ease-out, transform 0.6s ease-out;
    }

    .burst-active {
      opacity: 1;
      transform: scale(1.0);
    }

    @media (max-width: 768px) {
      #sigillum-wrapper {
        width: 98%;
      }
      .codex {
        letter-spacing: 0.7px;
      }
    }
  </style>
</head>

<body>

  <audio id="bg-audio" preload="auto">
    <source src="grieg_morning_mood.mp3" type="audio/mpeg" />
  </audio>

  <div id="starfield"></div>

  <main>
    <!-- OBERER TITEL (A) -->
    <svg class="siegel-heading" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1600 250">
      <g transform="translate(800,125)">
        <text class="codex" font-size="62"  x="-580">Δ</text>
        <text class="codex" font-size="62"  x="-360">QUARE</text>
        <text class="codex" font-size="100" x="0">MUNDI</text>
        <text class="codex" font-size="62"  x="360">SUNT?</text>
      </g>
    </svg>

    <!-- SIGILLUM -->
    <div id="siegel-container">
      <div id="sigillum-wrapper">
        <div id="sigillum-burst"></div>
        <object id="sigillum-img"
          data="sigillum_codex_delta_orbis.svg"
          type="image/svg+xml">
        </object>
        <div id="sigillum-click-overlay"></div>
      </div>
    </div>

    <!-- UNTERER TITEL (B) -->
    <svg class="siegel-subheading" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1600 250">
      <g transform="translate(800,125)">
        <text class="codex" font-size="62"  x="-580">!Δ</text>
        <text class="codex" font-size="62"  x="-360">QUARE</text>
        <text class="codex" font-size="100" x="0">MUNDI</text>
        <text class="codex" font-size="62"  x="360">SUNT!</text>
      </g>
    </svg>
  </main>

  <!-- STARFIELD – dynamische Sterne -->
  <script>
  (function() {
    const starfield   = document.getElementById("starfield");
    const MAX_STARS   = 260;
    const MIN_STARS   = 220;

    if (!starfield) return;

    function createFixedStar() {
      const s = document.createElement("div");
      s.className = "star-fixed";

      s.style.top  = Math.random() * 100 + "vh";
      s.style.left = Math.random() * 100 + "vw";

      const size = 1 + Math.random() * 2.5;
      s.style.width  = size + "px";
      s.style.height = size + "px";

      const dur   = 8 + Math.random() * 12;  // 8–20 s
      const delay = Math.random() * 20;      // 0–20 s
      s.style.animationDuration = dur + "s";
      s.style.animationDelay    = delay + "s";

      return s;
    }

    // Anfangspopulation
    for (let i = 0; i < MAX_STARS; i++) {
      starfield.appendChild(createFixedStar());
    }

    // langsam neue Sterne erzeugen und alte verschwinden lassen
    function refreshStars() {
      const stars = starfield.querySelectorAll(".star-fixed");
      let count   = stars.length;

      // einige alte Sterne entfernen
      if (count > MIN_STARS && Math.random() < 0.7) {
        const removeCount = 3 + Math.floor(Math.random() * 5); // 3–7
        for (let i = 0; i < removeCount && count > MIN_STARS; i++) {
          const list = starfield.querySelectorAll(".star-fixed");
          const idx  = Math.floor(Math.random() * list.length);
          const star = list[idx];
          if (star && star.parentNode === starfield) {
            starfield.removeChild(star);
            count--;
          }
        }
      }

      // wieder auffüllen bis MAX_STARS
      while (count < MAX_STARS) {
        starfield.appendChild(createFixedStar());
        count++;
      }

      const nextDelay = 25000 + Math.random() * 20000; // 25–45 s
      setTimeout(refreshStars, nextDelay);
    }

    // aus der Mitte herausfliegende Sterne
    function spawnFlyingStar() {
      const f = document.createElement("div");
      f.className = "star-fly";

      // zufällige Richtung aus dem Zentrum
      const angle = Math.random() * Math.PI * 2;
      const baseDistance = 8 + Math.random() * 10; // in vw/vh als Basis

      const vx = Math.cos(angle) * baseDistance;
      const vy = Math.sin(angle) * baseDistance;

      f.style.setProperty("--vx", vx + "vw");
      f.style.setProperty("--vy", vy + "vh");

      starfield.appendChild(f);

      f.addEventListener("animationend", () => {
        if (f.parentNode === starfield) {
          starfield.removeChild(f);
        }
      }, { once: true });
    }

    function scheduleFlyingStar() {
      spawnFlyingStar();
      const next = 5000 + Math.random() * 9000; // alle 5–14 s
      setTimeout(scheduleFlyingStar, next);
    }

    refreshStars();
    setTimeout(scheduleFlyingStar, 12000);

    window.__createFixedStar = createFixedStar;
  })();
  </script>

  <!-- Dante-Rotation -->
  <script>
    let danteRotationRequested = false;
    let danteRotationActivated = false;

    function tryStartDanteRotation() {
      if (danteRotationActivated) return;
      const obj = document.getElementById("sigillum-img");
      if (!obj) return;
      const svgDoc = obj.contentDocument;
      if (!svgDoc) return;
      const dante = svgDoc.getElementById("dante-ring");
      if (!dante) return;
      dante.classList.add("rotate-dante");
      danteRotationActivated = true;
    }

    window.addEventListener("DOMContentLoaded", () => {
      const obj = document.getElementById("sigillum-img");
      if (obj) {
        obj.addEventListener("load", () => {
          if (danteRotationRequested) {
            tryStartDanteRotation();
          }
        });
      }
    });
  </script>

  <!-- Überschrift & Siegel erscheinen -->
  <script>
  window.addEventListener("DOMContentLoaded", () => {
    setTimeout(() => {
      document.querySelector(".siegel-heading")?.classList.add("visible");
      const sf = document.getElementById("starfield");
      if (sf) {
        sf.style.transform = "scale(1)";
        sf.style.opacity = "1";
      }
    }, 1000);

    setTimeout(() => {
      document.getElementById("sigillum-wrapper")?.classList.add("visible-sigil");
    }, 3000);
  });
  </script>

  <!-- START: Zoom + Musik + Überschriften-Zyklus -->
  <script>
  (function(){
    let started = false;
    window.codexBurstsEnabled = true;

    function startAll(){
      if (started) return;
      started = true;

      const wrapper  = document.getElementById("sigillum-wrapper");
      const img      = document.getElementById("sigillum-img");
      const audio    = document.getElementById("bg-audio");
      const overlay  = document.getElementById("sigillum-click-overlay");

      if (overlay) overlay.style.pointerEvents = "none";

      window.codexBurstsEnabled = false;
      const burstEl = document.getElementById("sigillum-burst");
      if (burstEl) burstEl.style.opacity = "0";

      document.querySelector(".siegel-heading")?.classList.add("heading-glow");

      function startZoom(){
        const startScale = 0.05;
        const target     = 1.1;
        const duration   = 89000;
        let   startTime  = null;

        function anim(ts){
          if (!startTime) startTime = ts;
          let t = (ts - startTime) / duration;
          if (t > 1) t = 1;

          const eased  = 1 - Math.pow(1 - t, 3);
          const scale  = startScale + (target - startScale) * eased;
          wrapper.style.transform = "scale(" + scale.toFixed(4) + ")";

          if (t < 1) {
            requestAnimationFrame(anim);
          } else {
            wrapper.style.transform = "scale(1.1)";
            wrapper.classList.add("orbit");
            img.classList.add("breath-cycle");

            danteRotationRequested = true;
            tryStartDanteRotation();

            const top = document.querySelector(".siegel-heading");
            const sub = document.querySelector(".siegel-subheading");

            if (sub) sub.classList.add("visible");

            if (top && sub) {
              const showTop = (on) => top.classList.toggle("fade-out", !on);
              const showSub = (on) => sub.classList.toggle("fade-out", !on);

              const A_VISIBLE   = 7000;
              const B_VISIBLE   = 7000;
              const CYCLE_LIMIT = 140000;
              const cycleStart  = performance.now();

              // Start: nur Unterüberschrift
              showTop(false);
              showSub(true);

              function runCycle() {
                const now = performance.now();
                if (now - cycleStart >= CYCLE_LIMIT) {
                  showTop(true);
                  showSub(true);
                  return;
                }

                // Phase 1: A sichtbar, B aus
                showTop(true);
                showSub(false);

                setTimeout(() => {
                  const now2 = performance.now();
                  if (now2 - cycleStart >= CYCLE_LIMIT) {
                    showTop(true);
                    showSub(true);
                    return;
                  }

                  // Phase 2: B sichtbar, A aus
                  showTop(false);
                  showSub(true);

                  setTimeout(runCycle, B_VISIBLE);
                }, A_VISIBLE);
              }

              setTimeout(runCycle, B_VISIBLE);
            }
          }
        }

        requestAnimationFrame(anim);
      }

      startZoom();

      if (audio) {
        audio.volume = 0;
        audio.play().then(() => {
          const steps    = 40;
          const stepTime = 4000 / steps;
          let   vol      = 0;
          const fade = setInterval(() => {
            vol++;
            audio.volume = Math.min(1, vol / steps);
            if (vol >= steps) clearInterval(fade);
          }, stepTime);
        }).catch(() => {});
      }

      document.removeEventListener("click",      startAll);
      document.removeEventListener("keydown",    startAll);
      document.removeEventListener("touchstart", startAll);
    }

    document.addEventListener("click",      startAll);
    document.addEventListener("keydown",    startAll);
    document.addEventListener("touchstart", startAll);

    window.addEventListener("DOMContentLoaded", () => {
      const overlay = document.getElementById("sigillum-click-overlay");
      if (overlay) {
        overlay.addEventListener("click", startAll);
      }
    });
  })();
  </script>

  <!-- BURSTS IM IDLE -->
  <script>
  (function(){
    const burst = document.getElementById("sigillum-burst");

    function schedule(){
      const delay = 2800 + Math.random() * 3800;

      setTimeout(() => {
        if (!window.codexBurstsEnabled) return;

        const ox = (Math.random() - 0.5) * 10;
        const oy = (Math.random() - 0.5) * 10;
        burst.style.transform = `translate(${ox}px,${oy}px) scale(0.2)`;
        burst.classList.add("burst-active");

        setTimeout(() => {
          burst.classList.remove("burst-active");
          burst.style.transform = "scale(0.2)";
          schedule();
        }, 600);

      }, delay);
    }

    window.addEventListener("DOMContentLoaded", () => setTimeout(schedule, 3200));
  })();
  </script>

</body>
</html>
